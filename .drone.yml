---
kind: pipeline
name: Lint

platform:
  os: linux
  arch: amd64

steps:
- name: Arch
  image: hashicorp/packer
  commands:
  - apk --no-cache add make
  - make validate OS=arch OS_REV=2019-01-09
  depends_on:
  - clone

- name: CentOS 6
  image: hashicorp/packer
  commands:
  - apk --no-cache add make
  - make validate OS=centos OS_REV=6
  depends_on:
  - clone

- name: CentOS 7
  image: hashicorp/packer
  commands:
  - apk --no-cache add make
  - make validate OS=centos OS_REV=7
  depends_on:
  - clone

- name: Debian 8
  image: hashicorp/packer
  commands:
  - apk --no-cache add make
  - make validate OS=debian OS_REV=8
  depends_on:
  - clone

- name: Debian 9
  image: hashicorp/packer
  commands:
  - apk --no-cache add make
  - make validate OS=debian OS_REV=9
  depends_on:
  - clone

- name: Fedora 28
  image: hashicorp/packer
  commands:
  - apk --no-cache add make
  - make validate OS=fedora OS_REV=28
  depends_on:
  - clone

- name: Fedora 29
  image: hashicorp/packer
  commands:
  - apk --no-cache add make
  - make validate OS=fedora OS_REV=29
  depends_on:
  - clone

- name: Opensuse 15
  image: hashicorp/packer
  commands:
  - apk --no-cache add make
  - make validate OS=opensuse OS_REV=15
  depends_on:
  - clone

- name: Opensuse 42.3
  image: hashicorp/packer
  commands:
  - apk --no-cache add make
  - make validate OS=opensuse OS_REV=42.3
  depends_on:
  - clone

- name: Ubuntu 1404
  image: hashicorp/packer
  commands:
  - apk --no-cache add make
  - make validate OS=ubuntu OS_REV=1404
  depends_on:
  - clone

- name: Ubuntu 1604
  image: hashicorp/packer
  commands:
  - apk --no-cache add make
  - make validate OS=ubuntu OS_REV=1604
  depends_on:
  - clone

- name: Ubuntu 1804
  image: hashicorp/packer
  commands:
  - apk --no-cache add make
  - make validate OS=ubuntu OS_REV=1804
  depends_on:
  - clone

- name: Windows 2012r2
  image: hashicorp/packer
  commands:
  - apk --no-cache add make
  - make validate OS=windows OS_REV=2012r2
  depends_on:
  - clone

- name: Windows 2016
  image: hashicorp/packer
  commands:
  - apk --no-cache add make
  - make validate OS=windows OS_REV=2016
  depends_on:
  - clone

- name: Windows 2019
  image: hashicorp/packer
  commands:
  - apk --no-cache add make
  - make validate OS=windows OS_REV=2019
  depends_on:
  - clone

---
kind: pipeline
name: Arch

platform:
  os: linux
  arch: amd64

steps:
- name: throttle-build
  image: alpine
  commands:
  - "sh -c 'echo Sleeping 28 seconds; sleep 28'"

- name: 2017.7
  image: hashicorp/packer
  commands:
  - apk --no-cache add make curl grep gawk sed
  - make build OS=arch OS_REV=2019-01-09 SALT_BRANCH=2017.7
  environment:
    AWS_ACCESS_KEY_ID:
      from_secret: username
    AWS_DEFAULT_REGION: us-west-2
    AWS_SECRET_ACCESS_KEY:
      from_secret: password
  depends_on:
  - throttle-build

- name: 2018.3
  image: hashicorp/packer
  commands:
  - apk --no-cache add make curl grep gawk sed
  - make build OS=arch OS_REV=2019-01-09 SALT_BRANCH=2018.3
  environment:
    AWS_ACCESS_KEY_ID:
      from_secret: username
    AWS_DEFAULT_REGION: us-west-2
    AWS_SECRET_ACCESS_KEY:
      from_secret: password
  depends_on:
  - throttle-build

- name: 2019.2
  image: hashicorp/packer
  commands:
  - apk --no-cache add make curl grep gawk sed
  - make build OS=arch OS_REV=2019-01-09 SALT_BRANCH=2019.2
  environment:
    AWS_ACCESS_KEY_ID:
      from_secret: username
    AWS_DEFAULT_REGION: us-west-2
    AWS_SECRET_ACCESS_KEY:
      from_secret: password
  depends_on:
  - throttle-build

- name: develop
  image: hashicorp/packer
  commands:
  - apk --no-cache add make curl grep gawk sed
  - make build OS=arch OS_REV=2019-01-09 SALT_BRANCH=develop
  environment:
    AWS_ACCESS_KEY_ID:
      from_secret: username
    AWS_DEFAULT_REGION: us-west-2
    AWS_SECRET_ACCESS_KEY:
      from_secret: password
  depends_on:
  - throttle-build

trigger:
  event:
  - tag
  ref:
  - "refs/tags/v2.*"

depends_on:
- Lint

---
kind: pipeline
name: CentOS 6

platform:
  os: linux
  arch: amd64

steps:
- name: throttle-build
  image: alpine
  commands:
  - "sh -c 'echo Sleeping 56 seconds; sleep 56'"

- name: 2017.7
  image: hashicorp/packer
  commands:
  - apk --no-cache add make curl grep gawk sed
  - make build OS=centos OS_REV=6 SALT_BRANCH=2017.7
  environment:
    AWS_ACCESS_KEY_ID:
      from_secret: username
    AWS_DEFAULT_REGION: us-west-2
    AWS_SECRET_ACCESS_KEY:
      from_secret: password
  depends_on:
  - throttle-build

- name: 2018.3
  image: hashicorp/packer
  commands:
  - apk --no-cache add make curl grep gawk sed
  - make build OS=centos OS_REV=6 SALT_BRANCH=2018.3
  environment:
    AWS_ACCESS_KEY_ID:
      from_secret: username
    AWS_DEFAULT_REGION: us-west-2
    AWS_SECRET_ACCESS_KEY:
      from_secret: password
  depends_on:
  - throttle-build

- name: 2019.2
  image: hashicorp/packer
  commands:
  - apk --no-cache add make curl grep gawk sed
  - make build OS=centos OS_REV=6 SALT_BRANCH=2019.2
  environment:
    AWS_ACCESS_KEY_ID:
      from_secret: username
    AWS_DEFAULT_REGION: us-west-2
    AWS_SECRET_ACCESS_KEY:
      from_secret: password
  depends_on:
  - throttle-build

- name: develop
  image: hashicorp/packer
  commands:
  - apk --no-cache add make curl grep gawk sed
  - make build OS=centos OS_REV=6 SALT_BRANCH=develop
  environment:
    AWS_ACCESS_KEY_ID:
      from_secret: username
    AWS_DEFAULT_REGION: us-west-2
    AWS_SECRET_ACCESS_KEY:
      from_secret: password
  depends_on:
  - throttle-build

trigger:
  event:
  - tag
  ref:
  - "refs/tags/v2.*"

depends_on:
- Lint

---
kind: pipeline
name: CentOS 7

platform:
  os: linux
  arch: amd64

steps:
- name: throttle-build
  image: alpine
  commands:
  - "sh -c 'echo Sleeping 84 seconds; sleep 84'"

- name: 2017.7
  image: hashicorp/packer
  commands:
  - apk --no-cache add make curl grep gawk sed
  - make build OS=centos OS_REV=7 SALT_BRANCH=2017.7
  environment:
    AWS_ACCESS_KEY_ID:
      from_secret: username
    AWS_DEFAULT_REGION: us-west-2
    AWS_SECRET_ACCESS_KEY:
      from_secret: password
  depends_on:
  - throttle-build

- name: 2018.3
  image: hashicorp/packer
  commands:
  - apk --no-cache add make curl grep gawk sed
  - make build OS=centos OS_REV=7 SALT_BRANCH=2018.3
  environment:
    AWS_ACCESS_KEY_ID:
      from_secret: username
    AWS_DEFAULT_REGION: us-west-2
    AWS_SECRET_ACCESS_KEY:
      from_secret: password
  depends_on:
  - throttle-build

- name: 2019.2
  image: hashicorp/packer
  commands:
  - apk --no-cache add make curl grep gawk sed
  - make build OS=centos OS_REV=7 SALT_BRANCH=2019.2
  environment:
    AWS_ACCESS_KEY_ID:
      from_secret: username
    AWS_DEFAULT_REGION: us-west-2
    AWS_SECRET_ACCESS_KEY:
      from_secret: password
  depends_on:
  - throttle-build

- name: develop
  image: hashicorp/packer
  commands:
  - apk --no-cache add make curl grep gawk sed
  - make build OS=centos OS_REV=7 SALT_BRANCH=develop
  environment:
    AWS_ACCESS_KEY_ID:
      from_secret: username
    AWS_DEFAULT_REGION: us-west-2
    AWS_SECRET_ACCESS_KEY:
      from_secret: password
  depends_on:
  - throttle-build

trigger:
  event:
  - tag
  ref:
  - "refs/tags/v2.*"

depends_on:
- Lint

---
kind: pipeline
name: Debian 8

platform:
  os: linux
  arch: amd64

steps:
- name: throttle-build
  image: alpine
  commands:
  - "sh -c 'echo Sleeping 112 seconds; sleep 112'"

- name: 2017.7
  image: hashicorp/packer
  commands:
  - apk --no-cache add make curl grep gawk sed
  - make build OS=debian OS_REV=8 SALT_BRANCH=2017.7
  environment:
    AWS_ACCESS_KEY_ID:
      from_secret: username
    AWS_DEFAULT_REGION: us-west-2
    AWS_SECRET_ACCESS_KEY:
      from_secret: password
  depends_on:
  - throttle-build

- name: 2018.3
  image: hashicorp/packer
  commands:
  - apk --no-cache add make curl grep gawk sed
  - make build OS=debian OS_REV=8 SALT_BRANCH=2018.3
  environment:
    AWS_ACCESS_KEY_ID:
      from_secret: username
    AWS_DEFAULT_REGION: us-west-2
    AWS_SECRET_ACCESS_KEY:
      from_secret: password
  depends_on:
  - throttle-build

- name: 2019.2
  image: hashicorp/packer
  commands:
  - apk --no-cache add make curl grep gawk sed
  - make build OS=debian OS_REV=8 SALT_BRANCH=2019.2
  environment:
    AWS_ACCESS_KEY_ID:
      from_secret: username
    AWS_DEFAULT_REGION: us-west-2
    AWS_SECRET_ACCESS_KEY:
      from_secret: password
  depends_on:
  - throttle-build

- name: develop
  image: hashicorp/packer
  commands:
  - apk --no-cache add make curl grep gawk sed
  - make build OS=debian OS_REV=8 SALT_BRANCH=develop
  environment:
    AWS_ACCESS_KEY_ID:
      from_secret: username
    AWS_DEFAULT_REGION: us-west-2
    AWS_SECRET_ACCESS_KEY:
      from_secret: password
  depends_on:
  - throttle-build

trigger:
  event:
  - tag
  ref:
  - "refs/tags/v2.*"

depends_on:
- Lint

---
kind: pipeline
name: Debian 9

platform:
  os: linux
  arch: amd64

steps:
- name: throttle-build
  image: alpine
  commands:
  - "sh -c 'echo Sleeping 140 seconds; sleep 140'"

- name: 2017.7
  image: hashicorp/packer
  commands:
  - apk --no-cache add make curl grep gawk sed
  - make build OS=debian OS_REV=9 SALT_BRANCH=2017.7
  environment:
    AWS_ACCESS_KEY_ID:
      from_secret: username
    AWS_DEFAULT_REGION: us-west-2
    AWS_SECRET_ACCESS_KEY:
      from_secret: password
  depends_on:
  - throttle-build

- name: 2018.3
  image: hashicorp/packer
  commands:
  - apk --no-cache add make curl grep gawk sed
  - make build OS=debian OS_REV=9 SALT_BRANCH=2018.3
  environment:
    AWS_ACCESS_KEY_ID:
      from_secret: username
    AWS_DEFAULT_REGION: us-west-2
    AWS_SECRET_ACCESS_KEY:
      from_secret: password
  depends_on:
  - throttle-build

- name: 2019.2
  image: hashicorp/packer
  commands:
  - apk --no-cache add make curl grep gawk sed
  - make build OS=debian OS_REV=9 SALT_BRANCH=2019.2
  environment:
    AWS_ACCESS_KEY_ID:
      from_secret: username
    AWS_DEFAULT_REGION: us-west-2
    AWS_SECRET_ACCESS_KEY:
      from_secret: password
  depends_on:
  - throttle-build

- name: develop
  image: hashicorp/packer
  commands:
  - apk --no-cache add make curl grep gawk sed
  - make build OS=debian OS_REV=9 SALT_BRANCH=develop
  environment:
    AWS_ACCESS_KEY_ID:
      from_secret: username
    AWS_DEFAULT_REGION: us-west-2
    AWS_SECRET_ACCESS_KEY:
      from_secret: password
  depends_on:
  - throttle-build

trigger:
  event:
  - tag
  ref:
  - "refs/tags/v2.*"

depends_on:
- Lint

---
kind: pipeline
name: Fedora 28

platform:
  os: linux
  arch: amd64

steps:
- name: throttle-build
  image: alpine
  commands:
  - "sh -c 'echo Sleeping 168 seconds; sleep 168'"

- name: 2017.7
  image: hashicorp/packer
  commands:
  - apk --no-cache add make curl grep gawk sed
  - make build OS=fedora OS_REV=28 SALT_BRANCH=2017.7
  environment:
    AWS_ACCESS_KEY_ID:
      from_secret: username
    AWS_DEFAULT_REGION: us-west-2
    AWS_SECRET_ACCESS_KEY:
      from_secret: password
  depends_on:
  - throttle-build

- name: 2018.3
  image: hashicorp/packer
  commands:
  - apk --no-cache add make curl grep gawk sed
  - make build OS=fedora OS_REV=28 SALT_BRANCH=2018.3
  environment:
    AWS_ACCESS_KEY_ID:
      from_secret: username
    AWS_DEFAULT_REGION: us-west-2
    AWS_SECRET_ACCESS_KEY:
      from_secret: password
  depends_on:
  - throttle-build

- name: 2019.2
  image: hashicorp/packer
  commands:
  - apk --no-cache add make curl grep gawk sed
  - make build OS=fedora OS_REV=28 SALT_BRANCH=2019.2
  environment:
    AWS_ACCESS_KEY_ID:
      from_secret: username
    AWS_DEFAULT_REGION: us-west-2
    AWS_SECRET_ACCESS_KEY:
      from_secret: password
  depends_on:
  - throttle-build

- name: develop
  image: hashicorp/packer
  commands:
  - apk --no-cache add make curl grep gawk sed
  - make build OS=fedora OS_REV=28 SALT_BRANCH=develop
  environment:
    AWS_ACCESS_KEY_ID:
      from_secret: username
    AWS_DEFAULT_REGION: us-west-2
    AWS_SECRET_ACCESS_KEY:
      from_secret: password
  depends_on:
  - throttle-build

trigger:
  event:
  - tag
  ref:
  - "refs/tags/v2.*"

depends_on:
- Lint

---
kind: pipeline
name: Fedora 29

platform:
  os: linux
  arch: amd64

steps:
- name: throttle-build
  image: alpine
  commands:
  - "sh -c 'echo Sleeping 196 seconds; sleep 196'"

- name: 2017.7
  image: hashicorp/packer
  commands:
  - apk --no-cache add make curl grep gawk sed
  - make build OS=fedora OS_REV=29 SALT_BRANCH=2017.7
  environment:
    AWS_ACCESS_KEY_ID:
      from_secret: username
    AWS_DEFAULT_REGION: us-west-2
    AWS_SECRET_ACCESS_KEY:
      from_secret: password
  depends_on:
  - throttle-build

- name: 2018.3
  image: hashicorp/packer
  commands:
  - apk --no-cache add make curl grep gawk sed
  - make build OS=fedora OS_REV=29 SALT_BRANCH=2018.3
  environment:
    AWS_ACCESS_KEY_ID:
      from_secret: username
    AWS_DEFAULT_REGION: us-west-2
    AWS_SECRET_ACCESS_KEY:
      from_secret: password
  depends_on:
  - throttle-build

- name: 2019.2
  image: hashicorp/packer
  commands:
  - apk --no-cache add make curl grep gawk sed
  - make build OS=fedora OS_REV=29 SALT_BRANCH=2019.2
  environment:
    AWS_ACCESS_KEY_ID:
      from_secret: username
    AWS_DEFAULT_REGION: us-west-2
    AWS_SECRET_ACCESS_KEY:
      from_secret: password
  depends_on:
  - throttle-build

- name: develop
  image: hashicorp/packer
  commands:
  - apk --no-cache add make curl grep gawk sed
  - make build OS=fedora OS_REV=29 SALT_BRANCH=develop
  environment:
    AWS_ACCESS_KEY_ID:
      from_secret: username
    AWS_DEFAULT_REGION: us-west-2
    AWS_SECRET_ACCESS_KEY:
      from_secret: password
  depends_on:
  - throttle-build

trigger:
  event:
  - tag
  ref:
  - "refs/tags/v2.*"

depends_on:
- Lint

---
kind: pipeline
name: Opensuse 15

platform:
  os: linux
  arch: amd64

steps:
- name: throttle-build
  image: alpine
  commands:
  - "sh -c 'echo Sleeping 224 seconds; sleep 224'"

- name: 2017.7
  image: hashicorp/packer
  commands:
  - apk --no-cache add make curl grep gawk sed
  - make build OS=opensuse OS_REV=15 SALT_BRANCH=2017.7
  environment:
    AWS_ACCESS_KEY_ID:
      from_secret: username
    AWS_DEFAULT_REGION: us-west-2
    AWS_SECRET_ACCESS_KEY:
      from_secret: password
  depends_on:
  - throttle-build

- name: 2018.3
  image: hashicorp/packer
  commands:
  - apk --no-cache add make curl grep gawk sed
  - make build OS=opensuse OS_REV=15 SALT_BRANCH=2018.3
  environment:
    AWS_ACCESS_KEY_ID:
      from_secret: username
    AWS_DEFAULT_REGION: us-west-2
    AWS_SECRET_ACCESS_KEY:
      from_secret: password
  depends_on:
  - throttle-build

- name: 2019.2
  image: hashicorp/packer
  commands:
  - apk --no-cache add make curl grep gawk sed
  - make build OS=opensuse OS_REV=15 SALT_BRANCH=2019.2
  environment:
    AWS_ACCESS_KEY_ID:
      from_secret: username
    AWS_DEFAULT_REGION: us-west-2
    AWS_SECRET_ACCESS_KEY:
      from_secret: password
  depends_on:
  - throttle-build

- name: develop
  image: hashicorp/packer
  commands:
  - apk --no-cache add make curl grep gawk sed
  - make build OS=opensuse OS_REV=15 SALT_BRANCH=develop
  environment:
    AWS_ACCESS_KEY_ID:
      from_secret: username
    AWS_DEFAULT_REGION: us-west-2
    AWS_SECRET_ACCESS_KEY:
      from_secret: password
  depends_on:
  - throttle-build

trigger:
  event:
  - tag
  ref:
  - "refs/tags/v2.*"

depends_on:
- Lint

---
kind: pipeline
name: Opensuse 42.3

platform:
  os: linux
  arch: amd64

steps:
- name: throttle-build
  image: alpine
  commands:
  - "sh -c 'echo Sleeping 252 seconds; sleep 252'"

- name: 2017.7
  image: hashicorp/packer
  commands:
  - apk --no-cache add make curl grep gawk sed
  - make build OS=opensuse OS_REV=42.3 SALT_BRANCH=2017.7
  environment:
    AWS_ACCESS_KEY_ID:
      from_secret: username
    AWS_DEFAULT_REGION: us-west-2
    AWS_SECRET_ACCESS_KEY:
      from_secret: password
  depends_on:
  - throttle-build

- name: 2018.3
  image: hashicorp/packer
  commands:
  - apk --no-cache add make curl grep gawk sed
  - make build OS=opensuse OS_REV=42.3 SALT_BRANCH=2018.3
  environment:
    AWS_ACCESS_KEY_ID:
      from_secret: username
    AWS_DEFAULT_REGION: us-west-2
    AWS_SECRET_ACCESS_KEY:
      from_secret: password
  depends_on:
  - throttle-build

- name: 2019.2
  image: hashicorp/packer
  commands:
  - apk --no-cache add make curl grep gawk sed
  - make build OS=opensuse OS_REV=42.3 SALT_BRANCH=2019.2
  environment:
    AWS_ACCESS_KEY_ID:
      from_secret: username
    AWS_DEFAULT_REGION: us-west-2
    AWS_SECRET_ACCESS_KEY:
      from_secret: password
  depends_on:
  - throttle-build

- name: develop
  image: hashicorp/packer
  commands:
  - apk --no-cache add make curl grep gawk sed
  - make build OS=opensuse OS_REV=42.3 SALT_BRANCH=develop
  environment:
    AWS_ACCESS_KEY_ID:
      from_secret: username
    AWS_DEFAULT_REGION: us-west-2
    AWS_SECRET_ACCESS_KEY:
      from_secret: password
  depends_on:
  - throttle-build

trigger:
  event:
  - tag
  ref:
  - "refs/tags/v2.*"

depends_on:
- Lint

---
kind: pipeline
name: Ubuntu 1404

platform:
  os: linux
  arch: amd64

steps:
- name: throttle-build
  image: alpine
  commands:
  - "sh -c 'echo Sleeping 280 seconds; sleep 280'"

- name: 2017.7
  image: hashicorp/packer
  commands:
  - apk --no-cache add make curl grep gawk sed
  - make build OS=ubuntu OS_REV=1404 SALT_BRANCH=2017.7
  environment:
    AWS_ACCESS_KEY_ID:
      from_secret: username
    AWS_DEFAULT_REGION: us-west-2
    AWS_SECRET_ACCESS_KEY:
      from_secret: password
  depends_on:
  - throttle-build

- name: 2018.3
  image: hashicorp/packer
  commands:
  - apk --no-cache add make curl grep gawk sed
  - make build OS=ubuntu OS_REV=1404 SALT_BRANCH=2018.3
  environment:
    AWS_ACCESS_KEY_ID:
      from_secret: username
    AWS_DEFAULT_REGION: us-west-2
    AWS_SECRET_ACCESS_KEY:
      from_secret: password
  depends_on:
  - throttle-build

- name: 2019.2
  image: hashicorp/packer
  commands:
  - apk --no-cache add make curl grep gawk sed
  - make build OS=ubuntu OS_REV=1404 SALT_BRANCH=2019.2
  environment:
    AWS_ACCESS_KEY_ID:
      from_secret: username
    AWS_DEFAULT_REGION: us-west-2
    AWS_SECRET_ACCESS_KEY:
      from_secret: password
  depends_on:
  - throttle-build

- name: develop
  image: hashicorp/packer
  commands:
  - apk --no-cache add make curl grep gawk sed
  - make build OS=ubuntu OS_REV=1404 SALT_BRANCH=develop
  environment:
    AWS_ACCESS_KEY_ID:
      from_secret: username
    AWS_DEFAULT_REGION: us-west-2
    AWS_SECRET_ACCESS_KEY:
      from_secret: password
  depends_on:
  - throttle-build

trigger:
  event:
  - tag
  ref:
  - "refs/tags/v2.*"

depends_on:
- Lint

---
kind: pipeline
name: Ubuntu 1604

platform:
  os: linux
  arch: amd64

steps:
- name: throttle-build
  image: alpine
  commands:
  - "sh -c 'echo Sleeping 308 seconds; sleep 308'"

- name: 2017.7
  image: hashicorp/packer
  commands:
  - apk --no-cache add make curl grep gawk sed
  - make build OS=ubuntu OS_REV=1604 SALT_BRANCH=2017.7
  environment:
    AWS_ACCESS_KEY_ID:
      from_secret: username
    AWS_DEFAULT_REGION: us-west-2
    AWS_SECRET_ACCESS_KEY:
      from_secret: password
  depends_on:
  - throttle-build

- name: 2018.3
  image: hashicorp/packer
  commands:
  - apk --no-cache add make curl grep gawk sed
  - make build OS=ubuntu OS_REV=1604 SALT_BRANCH=2018.3
  environment:
    AWS_ACCESS_KEY_ID:
      from_secret: username
    AWS_DEFAULT_REGION: us-west-2
    AWS_SECRET_ACCESS_KEY:
      from_secret: password
  depends_on:
  - throttle-build

- name: 2019.2
  image: hashicorp/packer
  commands:
  - apk --no-cache add make curl grep gawk sed
  - make build OS=ubuntu OS_REV=1604 SALT_BRANCH=2019.2
  environment:
    AWS_ACCESS_KEY_ID:
      from_secret: username
    AWS_DEFAULT_REGION: us-west-2
    AWS_SECRET_ACCESS_KEY:
      from_secret: password
  depends_on:
  - throttle-build

- name: develop
  image: hashicorp/packer
  commands:
  - apk --no-cache add make curl grep gawk sed
  - make build OS=ubuntu OS_REV=1604 SALT_BRANCH=develop
  environment:
    AWS_ACCESS_KEY_ID:
      from_secret: username
    AWS_DEFAULT_REGION: us-west-2
    AWS_SECRET_ACCESS_KEY:
      from_secret: password
  depends_on:
  - throttle-build

trigger:
  event:
  - tag
  ref:
  - "refs/tags/v2.*"

depends_on:
- Lint

---
kind: pipeline
name: Ubuntu 1804

platform:
  os: linux
  arch: amd64

steps:
- name: throttle-build
  image: alpine
  commands:
  - "sh -c 'echo Sleeping 336 seconds; sleep 336'"

- name: 2017.7
  image: hashicorp/packer
  commands:
  - apk --no-cache add make curl grep gawk sed
  - make build OS=ubuntu OS_REV=1804 SALT_BRANCH=2017.7
  environment:
    AWS_ACCESS_KEY_ID:
      from_secret: username
    AWS_DEFAULT_REGION: us-west-2
    AWS_SECRET_ACCESS_KEY:
      from_secret: password
  depends_on:
  - throttle-build

- name: 2018.3
  image: hashicorp/packer
  commands:
  - apk --no-cache add make curl grep gawk sed
  - make build OS=ubuntu OS_REV=1804 SALT_BRANCH=2018.3
  environment:
    AWS_ACCESS_KEY_ID:
      from_secret: username
    AWS_DEFAULT_REGION: us-west-2
    AWS_SECRET_ACCESS_KEY:
      from_secret: password
  depends_on:
  - throttle-build

- name: 2019.2
  image: hashicorp/packer
  commands:
  - apk --no-cache add make curl grep gawk sed
  - make build OS=ubuntu OS_REV=1804 SALT_BRANCH=2019.2
  environment:
    AWS_ACCESS_KEY_ID:
      from_secret: username
    AWS_DEFAULT_REGION: us-west-2
    AWS_SECRET_ACCESS_KEY:
      from_secret: password
  depends_on:
  - throttle-build

- name: develop
  image: hashicorp/packer
  commands:
  - apk --no-cache add make curl grep gawk sed
  - make build OS=ubuntu OS_REV=1804 SALT_BRANCH=develop
  environment:
    AWS_ACCESS_KEY_ID:
      from_secret: username
    AWS_DEFAULT_REGION: us-west-2
    AWS_SECRET_ACCESS_KEY:
      from_secret: password
  depends_on:
  - throttle-build

trigger:
  event:
  - tag
  ref:
  - "refs/tags/v2.*"

depends_on:
- Lint

---
kind: pipeline
name: Windows 2012r2

platform:
  os: linux
  arch: amd64

steps:
- name: throttle-build
  image: alpine
  commands:
  - "sh -c 'echo Sleeping 0 seconds; sleep 0'"

- name: 2017.7
  image: hashicorp/packer
  commands:
  - apk --no-cache add make curl grep gawk sed
  - make build OS=windows OS_REV=2012r2 SALT_BRANCH=2017.7
  environment:
    AWS_ACCESS_KEY_ID:
      from_secret: username
    AWS_DEFAULT_REGION: us-west-2
    AWS_SECRET_ACCESS_KEY:
      from_secret: password
  depends_on:
  - throttle-build

- name: 2018.3
  image: hashicorp/packer
  commands:
  - apk --no-cache add make curl grep gawk sed
  - make build OS=windows OS_REV=2012r2 SALT_BRANCH=2018.3
  environment:
    AWS_ACCESS_KEY_ID:
      from_secret: username
    AWS_DEFAULT_REGION: us-west-2
    AWS_SECRET_ACCESS_KEY:
      from_secret: password
  depends_on:
  - throttle-build

- name: 2019.2
  image: hashicorp/packer
  commands:
  - apk --no-cache add make curl grep gawk sed
  - make build OS=windows OS_REV=2012r2 SALT_BRANCH=2019.2
  environment:
    AWS_ACCESS_KEY_ID:
      from_secret: username
    AWS_DEFAULT_REGION: us-west-2
    AWS_SECRET_ACCESS_KEY:
      from_secret: password
  depends_on:
  - throttle-build

- name: develop
  image: hashicorp/packer
  commands:
  - apk --no-cache add make curl grep gawk sed
  - make build OS=windows OS_REV=2012r2 SALT_BRANCH=develop
  environment:
    AWS_ACCESS_KEY_ID:
      from_secret: username
    AWS_DEFAULT_REGION: us-west-2
    AWS_SECRET_ACCESS_KEY:
      from_secret: password
  depends_on:
  - throttle-build

trigger:
  event:
  - tag
  ref:
  - "refs/tags/v2.*"

depends_on:
- Lint

---
kind: pipeline
name: Windows 2016

platform:
  os: linux
  arch: amd64

steps:
- name: throttle-build
  image: alpine
  commands:
  - "sh -c 'echo Sleeping 0 seconds; sleep 0'"

- name: 2017.7
  image: hashicorp/packer
  commands:
  - apk --no-cache add make curl grep gawk sed
  - make build OS=windows OS_REV=2016 SALT_BRANCH=2017.7
  environment:
    AWS_ACCESS_KEY_ID:
      from_secret: username
    AWS_DEFAULT_REGION: us-west-2
    AWS_SECRET_ACCESS_KEY:
      from_secret: password
  depends_on:
  - throttle-build

- name: 2018.3
  image: hashicorp/packer
  commands:
  - apk --no-cache add make curl grep gawk sed
  - make build OS=windows OS_REV=2016 SALT_BRANCH=2018.3
  environment:
    AWS_ACCESS_KEY_ID:
      from_secret: username
    AWS_DEFAULT_REGION: us-west-2
    AWS_SECRET_ACCESS_KEY:
      from_secret: password
  depends_on:
  - throttle-build

- name: 2019.2
  image: hashicorp/packer
  commands:
  - apk --no-cache add make curl grep gawk sed
  - make build OS=windows OS_REV=2016 SALT_BRANCH=2019.2
  environment:
    AWS_ACCESS_KEY_ID:
      from_secret: username
    AWS_DEFAULT_REGION: us-west-2
    AWS_SECRET_ACCESS_KEY:
      from_secret: password
  depends_on:
  - throttle-build

- name: develop
  image: hashicorp/packer
  commands:
  - apk --no-cache add make curl grep gawk sed
  - make build OS=windows OS_REV=2016 SALT_BRANCH=develop
  environment:
    AWS_ACCESS_KEY_ID:
      from_secret: username
    AWS_DEFAULT_REGION: us-west-2
    AWS_SECRET_ACCESS_KEY:
      from_secret: password
  depends_on:
  - throttle-build

trigger:
  event:
  - tag
  ref:
  - "refs/tags/v2.*"

depends_on:
- Lint

---
kind: pipeline
name: Windows 2019

platform:
  os: linux
  arch: amd64

steps:
- name: throttle-build
  image: alpine
  commands:
  - "sh -c 'echo Sleeping 0 seconds; sleep 0'"

- name: 2017.7
  image: hashicorp/packer
  commands:
  - apk --no-cache add make curl grep gawk sed
  - make build OS=windows OS_REV=2019 SALT_BRANCH=2017.7
  environment:
    AWS_ACCESS_KEY_ID:
      from_secret: username
    AWS_DEFAULT_REGION: us-west-2
    AWS_SECRET_ACCESS_KEY:
      from_secret: password
  depends_on:
  - throttle-build

- name: 2018.3
  image: hashicorp/packer
  commands:
  - apk --no-cache add make curl grep gawk sed
  - make build OS=windows OS_REV=2019 SALT_BRANCH=2018.3
  environment:
    AWS_ACCESS_KEY_ID:
      from_secret: username
    AWS_DEFAULT_REGION: us-west-2
    AWS_SECRET_ACCESS_KEY:
      from_secret: password
  depends_on:
  - throttle-build

- name: 2019.2
  image: hashicorp/packer
  commands:
  - apk --no-cache add make curl grep gawk sed
  - make build OS=windows OS_REV=2019 SALT_BRANCH=2019.2
  environment:
    AWS_ACCESS_KEY_ID:
      from_secret: username
    AWS_DEFAULT_REGION: us-west-2
    AWS_SECRET_ACCESS_KEY:
      from_secret: password
  depends_on:
  - throttle-build

- name: develop
  image: hashicorp/packer
  commands:
  - apk --no-cache add make curl grep gawk sed
  - make build OS=windows OS_REV=2019 SALT_BRANCH=develop
  environment:
    AWS_ACCESS_KEY_ID:
      from_secret: username
    AWS_DEFAULT_REGION: us-west-2
    AWS_SECRET_ACCESS_KEY:
      from_secret: password
  depends_on:
  - throttle-build

trigger:
  event:
  - tag
  ref:
  - "refs/tags/v2.*"

depends_on:
- Lint

---
kind: pipeline
name: Arch (Staging)

platform:
  os: linux
  arch: amd64

steps:
- name: throttle-build
  image: alpine
  commands:
  - "sh -c 'echo Sleeping 28 seconds; sleep 28'"

- name: 2017.7
  image: hashicorp/packer
  commands:
  - apk --no-cache add make curl grep gawk sed
  - make build-staging OS=arch OS_REV=2019-01-09 SALT_BRANCH=2017.7
  environment:
    AWS_ACCESS_KEY_ID:
      from_secret: username
    AWS_DEFAULT_REGION: us-west-2
    AWS_SECRET_ACCESS_KEY:
      from_secret: password
  depends_on:
  - throttle-build

- name: 2018.3
  image: hashicorp/packer
  commands:
  - apk --no-cache add make curl grep gawk sed
  - make build-staging OS=arch OS_REV=2019-01-09 SALT_BRANCH=2018.3
  environment:
    AWS_ACCESS_KEY_ID:
      from_secret: username
    AWS_DEFAULT_REGION: us-west-2
    AWS_SECRET_ACCESS_KEY:
      from_secret: password
  depends_on:
  - throttle-build

- name: 2019.2
  image: hashicorp/packer
  commands:
  - apk --no-cache add make curl grep gawk sed
  - make build-staging OS=arch OS_REV=2019-01-09 SALT_BRANCH=2019.2
  environment:
    AWS_ACCESS_KEY_ID:
      from_secret: username
    AWS_DEFAULT_REGION: us-west-2
    AWS_SECRET_ACCESS_KEY:
      from_secret: password
  depends_on:
  - throttle-build

- name: develop
  image: hashicorp/packer
  commands:
  - apk --no-cache add make curl grep gawk sed
  - make build-staging OS=arch OS_REV=2019-01-09 SALT_BRANCH=develop
  environment:
    AWS_ACCESS_KEY_ID:
      from_secret: username
    AWS_DEFAULT_REGION: us-west-2
    AWS_SECRET_ACCESS_KEY:
      from_secret: password
  depends_on:
  - throttle-build

trigger:
  branch:
  - ci
  event:
  - push

depends_on:
- Lint

---
kind: pipeline
name: CentOS 6 (Staging)

platform:
  os: linux
  arch: amd64

steps:
- name: throttle-build
  image: alpine
  commands:
  - "sh -c 'echo Sleeping 56 seconds; sleep 56'"

- name: 2017.7
  image: hashicorp/packer
  commands:
  - apk --no-cache add make curl grep gawk sed
  - make build-staging OS=centos OS_REV=6 SALT_BRANCH=2017.7
  environment:
    AWS_ACCESS_KEY_ID:
      from_secret: username
    AWS_DEFAULT_REGION: us-west-2
    AWS_SECRET_ACCESS_KEY:
      from_secret: password
  depends_on:
  - throttle-build

- name: 2018.3
  image: hashicorp/packer
  commands:
  - apk --no-cache add make curl grep gawk sed
  - make build-staging OS=centos OS_REV=6 SALT_BRANCH=2018.3
  environment:
    AWS_ACCESS_KEY_ID:
      from_secret: username
    AWS_DEFAULT_REGION: us-west-2
    AWS_SECRET_ACCESS_KEY:
      from_secret: password
  depends_on:
  - throttle-build

- name: 2019.2
  image: hashicorp/packer
  commands:
  - apk --no-cache add make curl grep gawk sed
  - make build-staging OS=centos OS_REV=6 SALT_BRANCH=2019.2
  environment:
    AWS_ACCESS_KEY_ID:
      from_secret: username
    AWS_DEFAULT_REGION: us-west-2
    AWS_SECRET_ACCESS_KEY:
      from_secret: password
  depends_on:
  - throttle-build

- name: develop
  image: hashicorp/packer
  commands:
  - apk --no-cache add make curl grep gawk sed
  - make build-staging OS=centos OS_REV=6 SALT_BRANCH=develop
  environment:
    AWS_ACCESS_KEY_ID:
      from_secret: username
    AWS_DEFAULT_REGION: us-west-2
    AWS_SECRET_ACCESS_KEY:
      from_secret: password
  depends_on:
  - throttle-build

trigger:
  branch:
  - ci
  event:
  - push

depends_on:
- Lint

---
kind: pipeline
name: CentOS 7 (Staging)

platform:
  os: linux
  arch: amd64

steps:
- name: throttle-build
  image: alpine
  commands:
  - "sh -c 'echo Sleeping 84 seconds; sleep 84'"

- name: 2017.7
  image: hashicorp/packer
  commands:
  - apk --no-cache add make curl grep gawk sed
  - make build-staging OS=centos OS_REV=7 SALT_BRANCH=2017.7
  environment:
    AWS_ACCESS_KEY_ID:
      from_secret: username
    AWS_DEFAULT_REGION: us-west-2
    AWS_SECRET_ACCESS_KEY:
      from_secret: password
  depends_on:
  - throttle-build

- name: 2018.3
  image: hashicorp/packer
  commands:
  - apk --no-cache add make curl grep gawk sed
  - make build-staging OS=centos OS_REV=7 SALT_BRANCH=2018.3
  environment:
    AWS_ACCESS_KEY_ID:
      from_secret: username
    AWS_DEFAULT_REGION: us-west-2
    AWS_SECRET_ACCESS_KEY:
      from_secret: password
  depends_on:
  - throttle-build

- name: 2019.2
  image: hashicorp/packer
  commands:
  - apk --no-cache add make curl grep gawk sed
  - make build-staging OS=centos OS_REV=7 SALT_BRANCH=2019.2
  environment:
    AWS_ACCESS_KEY_ID:
      from_secret: username
    AWS_DEFAULT_REGION: us-west-2
    AWS_SECRET_ACCESS_KEY:
      from_secret: password
  depends_on:
  - throttle-build

- name: develop
  image: hashicorp/packer
  commands:
  - apk --no-cache add make curl grep gawk sed
  - make build-staging OS=centos OS_REV=7 SALT_BRANCH=develop
  environment:
    AWS_ACCESS_KEY_ID:
      from_secret: username
    AWS_DEFAULT_REGION: us-west-2
    AWS_SECRET_ACCESS_KEY:
      from_secret: password
  depends_on:
  - throttle-build

trigger:
  branch:
  - ci
  event:
  - push

depends_on:
- Lint

---
kind: pipeline
name: Debian 8 (Staging)

platform:
  os: linux
  arch: amd64

steps:
- name: throttle-build
  image: alpine
  commands:
  - "sh -c 'echo Sleeping 112 seconds; sleep 112'"

- name: 2017.7
  image: hashicorp/packer
  commands:
  - apk --no-cache add make curl grep gawk sed
  - make build-staging OS=debian OS_REV=8 SALT_BRANCH=2017.7
  environment:
    AWS_ACCESS_KEY_ID:
      from_secret: username
    AWS_DEFAULT_REGION: us-west-2
    AWS_SECRET_ACCESS_KEY:
      from_secret: password
  depends_on:
  - throttle-build

- name: 2018.3
  image: hashicorp/packer
  commands:
  - apk --no-cache add make curl grep gawk sed
  - make build-staging OS=debian OS_REV=8 SALT_BRANCH=2018.3
  environment:
    AWS_ACCESS_KEY_ID:
      from_secret: username
    AWS_DEFAULT_REGION: us-west-2
    AWS_SECRET_ACCESS_KEY:
      from_secret: password
  depends_on:
  - throttle-build

- name: 2019.2
  image: hashicorp/packer
  commands:
  - apk --no-cache add make curl grep gawk sed
  - make build-staging OS=debian OS_REV=8 SALT_BRANCH=2019.2
  environment:
    AWS_ACCESS_KEY_ID:
      from_secret: username
    AWS_DEFAULT_REGION: us-west-2
    AWS_SECRET_ACCESS_KEY:
      from_secret: password
  depends_on:
  - throttle-build

- name: develop
  image: hashicorp/packer
  commands:
  - apk --no-cache add make curl grep gawk sed
  - make build-staging OS=debian OS_REV=8 SALT_BRANCH=develop
  environment:
    AWS_ACCESS_KEY_ID:
      from_secret: username
    AWS_DEFAULT_REGION: us-west-2
    AWS_SECRET_ACCESS_KEY:
      from_secret: password
  depends_on:
  - throttle-build

trigger:
  branch:
  - ci
  event:
  - push

depends_on:
- Lint

---
kind: pipeline
name: Debian 9 (Staging)

platform:
  os: linux
  arch: amd64

steps:
- name: throttle-build
  image: alpine
  commands:
  - "sh -c 'echo Sleeping 140 seconds; sleep 140'"

- name: 2017.7
  image: hashicorp/packer
  commands:
  - apk --no-cache add make curl grep gawk sed
  - make build-staging OS=debian OS_REV=9 SALT_BRANCH=2017.7
  environment:
    AWS_ACCESS_KEY_ID:
      from_secret: username
    AWS_DEFAULT_REGION: us-west-2
    AWS_SECRET_ACCESS_KEY:
      from_secret: password
  depends_on:
  - throttle-build

- name: 2018.3
  image: hashicorp/packer
  commands:
  - apk --no-cache add make curl grep gawk sed
  - make build-staging OS=debian OS_REV=9 SALT_BRANCH=2018.3
  environment:
    AWS_ACCESS_KEY_ID:
      from_secret: username
    AWS_DEFAULT_REGION: us-west-2
    AWS_SECRET_ACCESS_KEY:
      from_secret: password
  depends_on:
  - throttle-build

- name: 2019.2
  image: hashicorp/packer
  commands:
  - apk --no-cache add make curl grep gawk sed
  - make build-staging OS=debian OS_REV=9 SALT_BRANCH=2019.2
  environment:
    AWS_ACCESS_KEY_ID:
      from_secret: username
    AWS_DEFAULT_REGION: us-west-2
    AWS_SECRET_ACCESS_KEY:
      from_secret: password
  depends_on:
  - throttle-build

- name: develop
  image: hashicorp/packer
  commands:
  - apk --no-cache add make curl grep gawk sed
  - make build-staging OS=debian OS_REV=9 SALT_BRANCH=develop
  environment:
    AWS_ACCESS_KEY_ID:
      from_secret: username
    AWS_DEFAULT_REGION: us-west-2
    AWS_SECRET_ACCESS_KEY:
      from_secret: password
  depends_on:
  - throttle-build

trigger:
  branch:
  - ci
  event:
  - push

depends_on:
- Lint

---
kind: pipeline
name: Fedora 28 (Staging)

platform:
  os: linux
  arch: amd64

steps:
- name: throttle-build
  image: alpine
  commands:
  - "sh -c 'echo Sleeping 168 seconds; sleep 168'"

- name: 2017.7
  image: hashicorp/packer
  commands:
  - apk --no-cache add make curl grep gawk sed
  - make build-staging OS=fedora OS_REV=28 SALT_BRANCH=2017.7
  environment:
    AWS_ACCESS_KEY_ID:
      from_secret: username
    AWS_DEFAULT_REGION: us-west-2
    AWS_SECRET_ACCESS_KEY:
      from_secret: password
  depends_on:
  - throttle-build

- name: 2018.3
  image: hashicorp/packer
  commands:
  - apk --no-cache add make curl grep gawk sed
  - make build-staging OS=fedora OS_REV=28 SALT_BRANCH=2018.3
  environment:
    AWS_ACCESS_KEY_ID:
      from_secret: username
    AWS_DEFAULT_REGION: us-west-2
    AWS_SECRET_ACCESS_KEY:
      from_secret: password
  depends_on:
  - throttle-build

- name: 2019.2
  image: hashicorp/packer
  commands:
  - apk --no-cache add make curl grep gawk sed
  - make build-staging OS=fedora OS_REV=28 SALT_BRANCH=2019.2
  environment:
    AWS_ACCESS_KEY_ID:
      from_secret: username
    AWS_DEFAULT_REGION: us-west-2
    AWS_SECRET_ACCESS_KEY:
      from_secret: password
  depends_on:
  - throttle-build

- name: develop
  image: hashicorp/packer
  commands:
  - apk --no-cache add make curl grep gawk sed
  - make build-staging OS=fedora OS_REV=28 SALT_BRANCH=develop
  environment:
    AWS_ACCESS_KEY_ID:
      from_secret: username
    AWS_DEFAULT_REGION: us-west-2
    AWS_SECRET_ACCESS_KEY:
      from_secret: password
  depends_on:
  - throttle-build

trigger:
  branch:
  - ci
  event:
  - push

depends_on:
- Lint

---
kind: pipeline
name: Fedora 29 (Staging)

platform:
  os: linux
  arch: amd64

steps:
- name: throttle-build
  image: alpine
  commands:
  - "sh -c 'echo Sleeping 196 seconds; sleep 196'"

- name: 2017.7
  image: hashicorp/packer
  commands:
  - apk --no-cache add make curl grep gawk sed
  - make build-staging OS=fedora OS_REV=29 SALT_BRANCH=2017.7
  environment:
    AWS_ACCESS_KEY_ID:
      from_secret: username
    AWS_DEFAULT_REGION: us-west-2
    AWS_SECRET_ACCESS_KEY:
      from_secret: password
  depends_on:
  - throttle-build

- name: 2018.3
  image: hashicorp/packer
  commands:
  - apk --no-cache add make curl grep gawk sed
  - make build-staging OS=fedora OS_REV=29 SALT_BRANCH=2018.3
  environment:
    AWS_ACCESS_KEY_ID:
      from_secret: username
    AWS_DEFAULT_REGION: us-west-2
    AWS_SECRET_ACCESS_KEY:
      from_secret: password
  depends_on:
  - throttle-build

- name: 2019.2
  image: hashicorp/packer
  commands:
  - apk --no-cache add make curl grep gawk sed
  - make build-staging OS=fedora OS_REV=29 SALT_BRANCH=2019.2
  environment:
    AWS_ACCESS_KEY_ID:
      from_secret: username
    AWS_DEFAULT_REGION: us-west-2
    AWS_SECRET_ACCESS_KEY:
      from_secret: password
  depends_on:
  - throttle-build

- name: develop
  image: hashicorp/packer
  commands:
  - apk --no-cache add make curl grep gawk sed
  - make build-staging OS=fedora OS_REV=29 SALT_BRANCH=develop
  environment:
    AWS_ACCESS_KEY_ID:
      from_secret: username
    AWS_DEFAULT_REGION: us-west-2
    AWS_SECRET_ACCESS_KEY:
      from_secret: password
  depends_on:
  - throttle-build

trigger:
  branch:
  - ci
  event:
  - push

depends_on:
- Lint

---
kind: pipeline
name: Opensuse 15 (Staging)

platform:
  os: linux
  arch: amd64

steps:
- name: throttle-build
  image: alpine
  commands:
  - "sh -c 'echo Sleeping 224 seconds; sleep 224'"

- name: 2017.7
  image: hashicorp/packer
  commands:
  - apk --no-cache add make curl grep gawk sed
  - make build-staging OS=opensuse OS_REV=15 SALT_BRANCH=2017.7
  environment:
    AWS_ACCESS_KEY_ID:
      from_secret: username
    AWS_DEFAULT_REGION: us-west-2
    AWS_SECRET_ACCESS_KEY:
      from_secret: password
  depends_on:
  - throttle-build

- name: 2018.3
  image: hashicorp/packer
  commands:
  - apk --no-cache add make curl grep gawk sed
  - make build-staging OS=opensuse OS_REV=15 SALT_BRANCH=2018.3
  environment:
    AWS_ACCESS_KEY_ID:
      from_secret: username
    AWS_DEFAULT_REGION: us-west-2
    AWS_SECRET_ACCESS_KEY:
      from_secret: password
  depends_on:
  - throttle-build

- name: 2019.2
  image: hashicorp/packer
  commands:
  - apk --no-cache add make curl grep gawk sed
  - make build-staging OS=opensuse OS_REV=15 SALT_BRANCH=2019.2
  environment:
    AWS_ACCESS_KEY_ID:
      from_secret: username
    AWS_DEFAULT_REGION: us-west-2
    AWS_SECRET_ACCESS_KEY:
      from_secret: password
  depends_on:
  - throttle-build

- name: develop
  image: hashicorp/packer
  commands:
  - apk --no-cache add make curl grep gawk sed
  - make build-staging OS=opensuse OS_REV=15 SALT_BRANCH=develop
  environment:
    AWS_ACCESS_KEY_ID:
      from_secret: username
    AWS_DEFAULT_REGION: us-west-2
    AWS_SECRET_ACCESS_KEY:
      from_secret: password
  depends_on:
  - throttle-build

trigger:
  branch:
  - ci
  event:
  - push

depends_on:
- Lint

---
kind: pipeline
name: Opensuse 42.3 (Staging)

platform:
  os: linux
  arch: amd64

steps:
- name: throttle-build
  image: alpine
  commands:
  - "sh -c 'echo Sleeping 252 seconds; sleep 252'"

- name: 2017.7
  image: hashicorp/packer
  commands:
  - apk --no-cache add make curl grep gawk sed
  - make build-staging OS=opensuse OS_REV=42.3 SALT_BRANCH=2017.7
  environment:
    AWS_ACCESS_KEY_ID:
      from_secret: username
    AWS_DEFAULT_REGION: us-west-2
    AWS_SECRET_ACCESS_KEY:
      from_secret: password
  depends_on:
  - throttle-build

- name: 2018.3
  image: hashicorp/packer
  commands:
  - apk --no-cache add make curl grep gawk sed
  - make build-staging OS=opensuse OS_REV=42.3 SALT_BRANCH=2018.3
  environment:
    AWS_ACCESS_KEY_ID:
      from_secret: username
    AWS_DEFAULT_REGION: us-west-2
    AWS_SECRET_ACCESS_KEY:
      from_secret: password
  depends_on:
  - throttle-build

- name: 2019.2
  image: hashicorp/packer
  commands:
  - apk --no-cache add make curl grep gawk sed
  - make build-staging OS=opensuse OS_REV=42.3 SALT_BRANCH=2019.2
  environment:
    AWS_ACCESS_KEY_ID:
      from_secret: username
    AWS_DEFAULT_REGION: us-west-2
    AWS_SECRET_ACCESS_KEY:
      from_secret: password
  depends_on:
  - throttle-build

- name: develop
  image: hashicorp/packer
  commands:
  - apk --no-cache add make curl grep gawk sed
  - make build-staging OS=opensuse OS_REV=42.3 SALT_BRANCH=develop
  environment:
    AWS_ACCESS_KEY_ID:
      from_secret: username
    AWS_DEFAULT_REGION: us-west-2
    AWS_SECRET_ACCESS_KEY:
      from_secret: password
  depends_on:
  - throttle-build

trigger:
  branch:
  - ci
  event:
  - push

depends_on:
- Lint

---
kind: pipeline
name: Ubuntu 1404 (Staging)

platform:
  os: linux
  arch: amd64

steps:
- name: throttle-build
  image: alpine
  commands:
  - "sh -c 'echo Sleeping 280 seconds; sleep 280'"

- name: 2017.7
  image: hashicorp/packer
  commands:
  - apk --no-cache add make curl grep gawk sed
  - make build-staging OS=ubuntu OS_REV=1404 SALT_BRANCH=2017.7
  environment:
    AWS_ACCESS_KEY_ID:
      from_secret: username
    AWS_DEFAULT_REGION: us-west-2
    AWS_SECRET_ACCESS_KEY:
      from_secret: password
  depends_on:
  - throttle-build

- name: 2018.3
  image: hashicorp/packer
  commands:
  - apk --no-cache add make curl grep gawk sed
  - make build-staging OS=ubuntu OS_REV=1404 SALT_BRANCH=2018.3
  environment:
    AWS_ACCESS_KEY_ID:
      from_secret: username
    AWS_DEFAULT_REGION: us-west-2
    AWS_SECRET_ACCESS_KEY:
      from_secret: password
  depends_on:
  - throttle-build

- name: 2019.2
  image: hashicorp/packer
  commands:
  - apk --no-cache add make curl grep gawk sed
  - make build-staging OS=ubuntu OS_REV=1404 SALT_BRANCH=2019.2
  environment:
    AWS_ACCESS_KEY_ID:
      from_secret: username
    AWS_DEFAULT_REGION: us-west-2
    AWS_SECRET_ACCESS_KEY:
      from_secret: password
  depends_on:
  - throttle-build

- name: develop
  image: hashicorp/packer
  commands:
  - apk --no-cache add make curl grep gawk sed
  - make build-staging OS=ubuntu OS_REV=1404 SALT_BRANCH=develop
  environment:
    AWS_ACCESS_KEY_ID:
      from_secret: username
    AWS_DEFAULT_REGION: us-west-2
    AWS_SECRET_ACCESS_KEY:
      from_secret: password
  depends_on:
  - throttle-build

trigger:
  branch:
  - ci
  event:
  - push

depends_on:
- Lint

---
kind: pipeline
name: Ubuntu 1604 (Staging)

platform:
  os: linux
  arch: amd64

steps:
- name: throttle-build
  image: alpine
  commands:
  - "sh -c 'echo Sleeping 308 seconds; sleep 308'"

- name: 2017.7
  image: hashicorp/packer
  commands:
  - apk --no-cache add make curl grep gawk sed
  - make build-staging OS=ubuntu OS_REV=1604 SALT_BRANCH=2017.7
  environment:
    AWS_ACCESS_KEY_ID:
      from_secret: username
    AWS_DEFAULT_REGION: us-west-2
    AWS_SECRET_ACCESS_KEY:
      from_secret: password
  depends_on:
  - throttle-build

- name: 2018.3
  image: hashicorp/packer
  commands:
  - apk --no-cache add make curl grep gawk sed
  - make build-staging OS=ubuntu OS_REV=1604 SALT_BRANCH=2018.3
  environment:
    AWS_ACCESS_KEY_ID:
      from_secret: username
    AWS_DEFAULT_REGION: us-west-2
    AWS_SECRET_ACCESS_KEY:
      from_secret: password
  depends_on:
  - throttle-build

- name: 2019.2
  image: hashicorp/packer
  commands:
  - apk --no-cache add make curl grep gawk sed
  - make build-staging OS=ubuntu OS_REV=1604 SALT_BRANCH=2019.2
  environment:
    AWS_ACCESS_KEY_ID:
      from_secret: username
    AWS_DEFAULT_REGION: us-west-2
    AWS_SECRET_ACCESS_KEY:
      from_secret: password
  depends_on:
  - throttle-build

- name: develop
  image: hashicorp/packer
  commands:
  - apk --no-cache add make curl grep gawk sed
  - make build-staging OS=ubuntu OS_REV=1604 SALT_BRANCH=develop
  environment:
    AWS_ACCESS_KEY_ID:
      from_secret: username
    AWS_DEFAULT_REGION: us-west-2
    AWS_SECRET_ACCESS_KEY:
      from_secret: password
  depends_on:
  - throttle-build

trigger:
  branch:
  - ci
  event:
  - push

depends_on:
- Lint

---
kind: pipeline
name: Ubuntu 1804 (Staging)

platform:
  os: linux
  arch: amd64

steps:
- name: throttle-build
  image: alpine
  commands:
  - "sh -c 'echo Sleeping 336 seconds; sleep 336'"

- name: 2017.7
  image: hashicorp/packer
  commands:
  - apk --no-cache add make curl grep gawk sed
  - make build-staging OS=ubuntu OS_REV=1804 SALT_BRANCH=2017.7
  environment:
    AWS_ACCESS_KEY_ID:
      from_secret: username
    AWS_DEFAULT_REGION: us-west-2
    AWS_SECRET_ACCESS_KEY:
      from_secret: password
  depends_on:
  - throttle-build

- name: 2018.3
  image: hashicorp/packer
  commands:
  - apk --no-cache add make curl grep gawk sed
  - make build-staging OS=ubuntu OS_REV=1804 SALT_BRANCH=2018.3
  environment:
    AWS_ACCESS_KEY_ID:
      from_secret: username
    AWS_DEFAULT_REGION: us-west-2
    AWS_SECRET_ACCESS_KEY:
      from_secret: password
  depends_on:
  - throttle-build

- name: 2019.2
  image: hashicorp/packer
  commands:
  - apk --no-cache add make curl grep gawk sed
  - make build-staging OS=ubuntu OS_REV=1804 SALT_BRANCH=2019.2
  environment:
    AWS_ACCESS_KEY_ID:
      from_secret: username
    AWS_DEFAULT_REGION: us-west-2
    AWS_SECRET_ACCESS_KEY:
      from_secret: password
  depends_on:
  - throttle-build

- name: develop
  image: hashicorp/packer
  commands:
  - apk --no-cache add make curl grep gawk sed
  - make build-staging OS=ubuntu OS_REV=1804 SALT_BRANCH=develop
  environment:
    AWS_ACCESS_KEY_ID:
      from_secret: username
    AWS_DEFAULT_REGION: us-west-2
    AWS_SECRET_ACCESS_KEY:
      from_secret: password
  depends_on:
  - throttle-build

trigger:
  branch:
  - ci
  event:
  - push

depends_on:
- Lint

---
kind: pipeline
name: Windows 2012r2 (Staging)

platform:
  os: linux
  arch: amd64

steps:
- name: throttle-build
  image: alpine
  commands:
  - "sh -c 'echo Sleeping 0 seconds; sleep 0'"

- name: 2017.7
  image: hashicorp/packer
  commands:
  - apk --no-cache add make curl grep gawk sed
  - make build-staging OS=windows OS_REV=2012r2 SALT_BRANCH=2017.7
  environment:
    AWS_ACCESS_KEY_ID:
      from_secret: username
    AWS_DEFAULT_REGION: us-west-2
    AWS_SECRET_ACCESS_KEY:
      from_secret: password
  depends_on:
  - throttle-build

- name: 2018.3
  image: hashicorp/packer
  commands:
  - apk --no-cache add make curl grep gawk sed
  - make build-staging OS=windows OS_REV=2012r2 SALT_BRANCH=2018.3
  environment:
    AWS_ACCESS_KEY_ID:
      from_secret: username
    AWS_DEFAULT_REGION: us-west-2
    AWS_SECRET_ACCESS_KEY:
      from_secret: password
  depends_on:
  - throttle-build

- name: 2019.2
  image: hashicorp/packer
  commands:
  - apk --no-cache add make curl grep gawk sed
  - make build-staging OS=windows OS_REV=2012r2 SALT_BRANCH=2019.2
  environment:
    AWS_ACCESS_KEY_ID:
      from_secret: username
    AWS_DEFAULT_REGION: us-west-2
    AWS_SECRET_ACCESS_KEY:
      from_secret: password
  depends_on:
  - throttle-build

- name: develop
  image: hashicorp/packer
  commands:
  - apk --no-cache add make curl grep gawk sed
  - make build-staging OS=windows OS_REV=2012r2 SALT_BRANCH=develop
  environment:
    AWS_ACCESS_KEY_ID:
      from_secret: username
    AWS_DEFAULT_REGION: us-west-2
    AWS_SECRET_ACCESS_KEY:
      from_secret: password
  depends_on:
  - throttle-build

trigger:
  branch:
  - ci
  event:
  - push

depends_on:
- Lint

---
kind: pipeline
name: Windows 2016 (Staging)

platform:
  os: linux
  arch: amd64

steps:
- name: throttle-build
  image: alpine
  commands:
  - "sh -c 'echo Sleeping 0 seconds; sleep 0'"

- name: 2017.7
  image: hashicorp/packer
  commands:
  - apk --no-cache add make curl grep gawk sed
  - make build-staging OS=windows OS_REV=2016 SALT_BRANCH=2017.7
  environment:
    AWS_ACCESS_KEY_ID:
      from_secret: username
    AWS_DEFAULT_REGION: us-west-2
    AWS_SECRET_ACCESS_KEY:
      from_secret: password
  depends_on:
  - throttle-build

- name: 2018.3
  image: hashicorp/packer
  commands:
  - apk --no-cache add make curl grep gawk sed
  - make build-staging OS=windows OS_REV=2016 SALT_BRANCH=2018.3
  environment:
    AWS_ACCESS_KEY_ID:
      from_secret: username
    AWS_DEFAULT_REGION: us-west-2
    AWS_SECRET_ACCESS_KEY:
      from_secret: password
  depends_on:
  - throttle-build

- name: 2019.2
  image: hashicorp/packer
  commands:
  - apk --no-cache add make curl grep gawk sed
  - make build-staging OS=windows OS_REV=2016 SALT_BRANCH=2019.2
  environment:
    AWS_ACCESS_KEY_ID:
      from_secret: username
    AWS_DEFAULT_REGION: us-west-2
    AWS_SECRET_ACCESS_KEY:
      from_secret: password
  depends_on:
  - throttle-build

- name: develop
  image: hashicorp/packer
  commands:
  - apk --no-cache add make curl grep gawk sed
  - make build-staging OS=windows OS_REV=2016 SALT_BRANCH=develop
  environment:
    AWS_ACCESS_KEY_ID:
      from_secret: username
    AWS_DEFAULT_REGION: us-west-2
    AWS_SECRET_ACCESS_KEY:
      from_secret: password
  depends_on:
  - throttle-build

trigger:
  branch:
  - ci
  event:
  - push

depends_on:
- Lint

---
kind: pipeline
name: Windows 2019 (Staging)

platform:
  os: linux
  arch: amd64

steps:
- name: throttle-build
  image: alpine
  commands:
  - "sh -c 'echo Sleeping 0 seconds; sleep 0'"

- name: 2017.7
  image: hashicorp/packer
  commands:
  - apk --no-cache add make curl grep gawk sed
  - make build-staging OS=windows OS_REV=2019 SALT_BRANCH=2017.7
  environment:
    AWS_ACCESS_KEY_ID:
      from_secret: username
    AWS_DEFAULT_REGION: us-west-2
    AWS_SECRET_ACCESS_KEY:
      from_secret: password
  depends_on:
  - throttle-build

- name: 2018.3
  image: hashicorp/packer
  commands:
  - apk --no-cache add make curl grep gawk sed
  - make build-staging OS=windows OS_REV=2019 SALT_BRANCH=2018.3
  environment:
    AWS_ACCESS_KEY_ID:
      from_secret: username
    AWS_DEFAULT_REGION: us-west-2
    AWS_SECRET_ACCESS_KEY:
      from_secret: password
  depends_on:
  - throttle-build

- name: 2019.2
  image: hashicorp/packer
  commands:
  - apk --no-cache add make curl grep gawk sed
  - make build-staging OS=windows OS_REV=2019 SALT_BRANCH=2019.2
  environment:
    AWS_ACCESS_KEY_ID:
      from_secret: username
    AWS_DEFAULT_REGION: us-west-2
    AWS_SECRET_ACCESS_KEY:
      from_secret: password
  depends_on:
  - throttle-build

- name: develop
  image: hashicorp/packer
  commands:
  - apk --no-cache add make curl grep gawk sed
  - make build-staging OS=windows OS_REV=2019 SALT_BRANCH=develop
  environment:
    AWS_ACCESS_KEY_ID:
      from_secret: username
    AWS_DEFAULT_REGION: us-west-2
    AWS_SECRET_ACCESS_KEY:
      from_secret: password
  depends_on:
  - throttle-build

trigger:
  branch:
  - ci
  event:
  - push

depends_on:
- Lint

---
kind: secret
type: general
data:
  password: >
    ood6DhiPeWBKZfSOqhsq-iJPmkfnrbdIonynU7Hdd_gTk4eeii_l4cbit9O3
    s5P-iX3CWa_v6RwKtKz9vQd6V0MuphwGxRAcSC1z4O3R0g==
  username: >
    I0tTPep0OuH_qwx5v5-cr4gONWEDbccbJ4yShpI369wV5WYYRuq1Gckx40A6
    _OK_ypQ4AfAiDjEsC2U=

---
kind: signature
hmac: 073fe2e1a64843de02ac74718a1ecc23df65806fd018613b4b8d44e3edb87bcd

...
